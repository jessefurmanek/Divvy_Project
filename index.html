<!DOCTYPE html>
<html>
<!-- //note: highly derivative of Mike Bostock's example: http://bl.ocks.org/mbostock/899711-->
 <head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
	  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
      
	  <style type="text/css">
      html, body, #map {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  
	  
	  .stations, .stations svg {
	    position: absolute;
	  }

	  .stations svg {
	    width: 60px;
	    height: 20px;
	    padding-right: 100px;
	    font: 10px sans-serif;
	  }

	  .stations circle {
	    fill: #25F;
	    stroke: grey;
	    stroke-width: .5px;
	  }
	  
	  </style>

</head>	

<body>
	  <div id="map"></div>
	  <script type="text/javascript">
	 
		 var map = new google.maps.Map(d3.select("#map").node(), {
	    	 zoom: 13,
	    	 center: new google.maps.LatLng(41.909460, -87.634145),
	    	 mapTypeId: google.maps.MapTypeId.ROADMAP
	 	 });
		 // Load the station data. When the data comes back, create an overlay.
		 d3.json("divvy_stations.json", function(data) {
		   var overlay = new google.maps.OverlayView();

		   // Add the container when the overlay is added to the map.
		   overlay.onAdd = function() {
		     var layer = d3.select(this.getPanes().overlayLayer).append("div")
		         .attr("class", "stations");

		 	    // Draw each marker as a separate SVG element.
		 	    overlay.draw = function() {
					
				var projection = this.getProjection(),
		          padding = 10;

				var marker = layer.selectAll("svg")
				     .data(data)
				     .each(transform) // update existing markers
				     .enter().append("svg:svg")
				     .each(transform)
				     .attr("class", "marker");
					 
				 marker.append("svg:circle")  //add circles
				     .attr("r", function (d) { return (d.dpcapacity)/5; })
		             .attr("cx", padding)
		             .attr("cy", padding);		
				 // Add a label.
				// marker.append("svg:text")
				  //   .attr("x", padding + 7)
				    // .attr("y", padding)
				     //.attr("dy", ".31em")
				     //.text(function(d) { return d.name; });

			     function transform(d) {
				      d = new google.maps.LatLng(d.latitude, d.longitude);
				      d = projection.fromLatLngToDivPixel(d);
					  
				      return d3.select(this) //you can do stuff after returning?
							.style("left", (d.x - padding) + "px")
					        .style("top", (d.y - padding) + "px");
					}	
   		     };
		   };
		   // Bind our overlay to the mapâ€¦
		   overlay.setMap(map);
		 });
		 
	  </script>
  </body>
</html>